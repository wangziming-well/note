# 异常概述



## 机制概述

* 程序中的异常：程序在运行过程中出现的非正常情况，比如处理了坏数据，或者打开不存在的文件，导致程序的非正常停止；

* Java针对于程序中的异常，提供了专门的异常处理机制/当程序发生异常时，异常机制提供了程序退出的安全通道，程序的执行流程发生改变，程序的控制权转移到了异常处理器
* 当程序出现异常时，异常机制会实例化一个异常类型的对象，在对象中封装异常相关的信息，比如：异常的类型，造成异常的数据，异常发生的位置

## 异常体系

* **java.long.Throwable**是所有异常错误的超类，只有作为此类或者此类的子类的实例对象才能由Java虚拟机抛出，或者通过throw语句抛出或者作为trycatch的catch子句的参数类型

* java.long.Error ：Throwable的子类，表示严重的问题，靠程序本身无法处理预防，遇到这样的问题只能终止程序。
* java.long.Exception：Throwable子类，表示可以处理的异常

## 异常Exception分类

Exception类分为两类

* 运行时异常：RuntimeException类及其子类
* 编译时异常：RuntimeException除外的Exception的子类都属于编译时期异常

# 异常处理

在Java程序中，对异常处理的方式有3中：抛出、声明、捕获

## throw抛出异常

* 语法格式：

    ~~~java
    throw new 异常对象(参数);
    ~~~

* 注意事项细节：

    * throw抛出异常语句只能写在方法体内部
    * throw抛出的异常类型必须是Throwable本身或其子类
    * 程序执行到throw语句时会立即终止
    * 无论是程序本身，还是程序员手动抛出的异常，JVM对异常的处理都是一样的



## 自定义异常类

* 如果某种异常Java中并不存在，则程序员可以根据业务需求自定义异常类型

* 自定义异常语法格式:

    ~~~java
    public class ExceptionClassName extends Exception / RuntimeException{
        //空参构造
        public ExceptionClassName() {
        }
        // 异常信息提示构造
        public ExceptionClassName(String message) {
            super(message);
        }
    }
    ~~~

* 注意事项：

    * 自定义异常类需要做到见名知意
    * 所有异常必须是Throwable的子类



## throws声明异常

* 场景：

    当方法中抛出异常（编译时期异常），但没有能力处理当前异常，或者没有处理该异常的具体处理方案，可以在方法签名上声明异常。讲该方法的异常，交由程序的上层调用者来处理。

* 格式

    ~~~java
    public void method() throws Exception1,Exception2...{}
    ~~~

* 注意事项

    * 声明的异常类型一般都是编译时期异常，运行时期异常一般不需要处理
    * 如果方法中通过throw语句抛出多个异常
        * 可以声明时声明所有异常
        * 或者抛出只声明多个异常的父类异常（不建议）
    * 子类重写父类方法时：
        * 如果父类方法没有声明异常，那么子类重写时也不可以声明异常
        * 如果父类方法声明了异常，那么子类可以声明也可以不声明异常



## try-catch 捕获异常

* 描述：通过try-catch语句，对程序中的异常捕获，并给出异常具体的解决方案

* 语法格式：

    ~~~java
    try{
        //可能发生异常的代码
    }catch(异常类型1 [|异常类型2] 变量名){//一次捕获多个异常 
        //处理异常
    }catch(异常类型3 变量名){
        //处理异常
    }...
    ~~~

* 捕获异常的原则：

    * 如果一个方法中抛出对个异常
        * 处理方案相同时，多个异常可以一起捕获
        * 处理方案不同时，则需要分别捕获，分别处理
    * 如果程序中多个方法存在异常
        * 如果多个方法之间存在业务关系，则一般一起捕获
        * 如果多个方法之间不存在业务关系，则一般分开捕获

## finally代码块

* 描述：

    * 属于try的子语句


    * 表示无论是否发生异常都会执行的代码


* 格式

    ~~~JAVA
    try{
        //可能发生异常的代码
    }catch( E e){
        //处理异常
    }finally{
        //不管是否发生异常都会执行的代码
    }
    
    ~~~
    
    
    
* 注意点：

    * 输出到控制台的错误信息是通过`System.err.println();`

        语句打印的，与`System.out.println();`是不同的线程，所以会有抢夺资源现象；

    * 如果有finally语句，这在return之后还会执行finally（return的值会暂存在栈里面，等待finally执行后再返回）





