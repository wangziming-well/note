# 实体-联系模型

实体-联系(entity-relationship,E-R)数据模型的提出使为了方便数据库的设计

E-R数据模型采用了三个基本概念：实体集、联系集和属性。

## 实体集

实体使现实世界中可区别于其他对象的一个事物或对象

实体集使相同类型的一个实体集合

实体通过一组属性来表示，属性使实体机中哦每个成员所拥有的描述性性质。

每个实体的每个属性都有一个值

## 联系集

**联系**是指多个实体间的相互关联。例如一个员工属于一个部门

**联系集**是相同类型联系的集合。确切的说，联系集是$n \ge 2$个实体集上的数学关系。如果$E_1,E_2,...,E_n$为实体集，则联系集$R$是：
$$
\{(e_1,e_2,...,e_n) | e_1 \in E_1,e_2 \in E_2,...,e_n \in E_n  \}
$$
的一个子集，而$(e_1,e_2,...,e_n)$是一个联系

例如一个实体集student,包含(A,B,C,D).一个实体集class包含(classA,classB),那么它们之间可以有联系集
$$
\{(A,classA) ,(B,classA),(C,classB),(D,classB) \}
$$
表示A，B在classA班，C，D在classB班

实体集之间的关联称为**参与**，也就是说实体集$E_1,E_2,...,E_n$参与联系集$R$.

E-R模式中的一个**联系实例**表示在所建模的显示时间中命名实体间的一个关联。

实体在联系中扮演的功能称为实体的**角色**。由于参与一个联系集的实体集通常是互异的，因此角色是隐含的并且一般并不指定。当联系的含义需要解释时角色是很有用的。

同样的实体集以不同的角色参与一个联系集多于一次，这样的联系集称为**自环的联系集**

在自环的联系集中，有必要使用显示的角色名来指明实体是如何参与联系实例的。

联系可以具有**描述性属性**，例如对于导师和学生之间的联系，可以将属性date与该联系关联起来，以表示教师称为学生导师的日期。

相同的实体集可能会参与到多个联系集中。

联系集一般是二元的，即涉及两个实体集的联系集。但有时联系集会涉及多于两个实体集。参与联系集的实体集的数目恒伟联系集的度。

## 属性

每个属性都有一个可取值的集合，称为该属性的域，或者值集。

实体集的属性是将实体集映射到域的函数。每个实体可以用一组(属性，值)来表示

E-R模型中的属性可以按照如下的属性类型进行划分：

* 简单和复合属性：简单属性是不能再划分为更小的部分的属性，而复合属性可以再次划分
* 单值和多值属性：如果一个属性对应一个值，就为单值属性；如果一个属性对应多个值，就为多值属性。特定情况下，可以对多值属性的值个数设置上下界

# 约束

E-R模式可以定义一些数据库中的数据必须满足的约束

## 映射基数

**映射基数**(mapping cardinality)，或者说基数比率，表示一个实体通过一个联系集能关联的实体的个数

映射基数在描述二元联系集时很有用，尽管它可以用于描述多元联系集。但我们只讨论二元联系集

对于实体集A和B之间的二元联系集R来说，映射基数必然是下面情况之一：

* 一对一：A中的一个实体至多与B中的一个实体相关联，并且B中的一个实体也至多与A中的一个实体相关联
* 一对多：A中的一个实体可以与B中的任意数目实体相关联，而B中的一个实体至多与A中的一个实体相关联
* 多对一：A中的一个实体至多与B中的一个实体相关联，B中的一个实体可以与A中任意数目实体相关联
* 多对多A中的一个实体可以与B中的任意数目实体相关联，B中的一个实体可以与A中任意数目实体相关联

一个特定联系集的适当的映射基数依赖于该联系集所建模的现实世界的情况

## 参与约束

如果实体集E中的每个实体都参与到联系集R的至少一个联系中，实体集E在联系集R中的参与称为全部的。如果E中只有部分实体参与到R的联系中，实体集R到联系集R的参与称为部分的。

## 码

在概念上来说，各个实体是互异的，但从数据库的观点来看，它们的区别必须通过其属性来表明。

因此，一个实体的属性的值必须可以唯一标识该实体。

关系模式中码的概念直接适用于实体集。即实体的码是一个足以区分每个实体的属性集。关系模式中的超码、候选码、主码的概念同样适用于实体集。

码同样用于唯一地标识联系，从而将联系互相区分开。

设R是一个涉及实体集$E_1,E_2,...,E_n$的联系集。设主码$(E_i)$代表构成实体集$E_i$的主码的属性集合。联系集主码的构成依赖于同联系集$R$相关联的属性集合：

如果联系集$R$有属性$a_1,a_2,...,a_n$与之关联，那么属性集合：
$$
primary-key(E_1)\cup primary-key(E_2)\cup ...\cup primary-key(E_n) \cup \{a_1,a2,...,a_n \}
$$
描述集合R中的一个联系，其中，属性集合：
$$
primary-key(E_1)\cup primary-key(E_2)\cup ...\cup primary-key(E_n)
$$
构成联系集的一个超码

联系集的主码结构依赖于联系集的映射基数。例如考虑实体集student和teacher和其联系集advisor。

* 如果联系是多对多的，那么advisor的主码由student和teacher的主码的并集构成
* 如果联系是多对一的，那么advisor的主码由teacher的主码构成
* 如果联系是一对一的，主码可以是teacher或者student的主码中的一个

# 实体-联系图

E-R图(E-R diagram)可以图形化表示数据库的全局逻辑结构。

## 基本结构

E-R图包括如下几个主要构件：

* 分成两部分的矩阵代表实体集。上半部分表示实体集的名字，下半部分表示实体集中所有属性的名字
* 菱形代表联系集
* 未分割的矩形代表联系集的属性。构成主码的属性以下划线标明
* 线段将实体集连接到联系集
* 虚线将联系集属性连接到联系集
* 双线显示实体在联系集中的参与度
* 双菱形代表到弱实体集的标志性联系集

例如如下E-R图：

![E-Rdemo1](https://gitee.com/wangziming707/note-pic/raw/master/img/E-Rdemo1.png)

表示通过二元联系集advisor关联的两个实体集instructor和student，并且该联系集advisor有描述性属性date

## 映射基数

实体集之间的联系可以是一对一、一对多、多对一和多对多的。可以通过实体集和联系集之间的箭头区分这些区别：

* 一对一：

  ![1for1E-R](https://gitee.com/wangziming707/note-pic/raw/master/img/1for1E-R.png)

* 一对多：

  ![1forNE-R](https://gitee.com/wangziming707/note-pic/raw/master/img/1forNE-R.png)

* 多对多：

  ![NforME-R](https://gitee.com/wangziming707/note-pic/raw/master/img/NforME-R.png)

E-R图还提供了一种描述每个实体参与联系找那个的联系的次数的更复杂的约束的方法：实体集和二元联系集之间的一条边可以有一个关联的最大和最小的映射基数，用`l...h`的形式表示，其中`l`表示最小的映射基数，而`h`表示最大的映射基数。

最小值为1表示这个实体集在该联系集中全部参与，即实体集中每个实体在联系集中至少一个联系

最大值为1表示这个实体参与至多1个联系

最大值为`*`表示没有限制

例如：

![MappingCardinalitiesConstraintE-R](https://gitee.com/wangziming707/note-pic/raw/master/img/MappingCardinalitiesConstraintE-R.png)

表示每个教师可以有0个或者无限多个学生

而每个学生必须有且只能有1个导师

## 复杂的属性

对于复合属性，可以使用缩进表示一个复合属性的子属性，如图：

![ComplexPropertyE-R](https://gitee.com/wangziming707/note-pic/raw/master/img/ComplexPropertyE-R.png)

## 角色

在E-R图中，我们通过在菱形和矩阵之间的连线上进行标注来表示角色，表示实体参与联系时的角色。

之前我们已经讨论过了，在自环联系集中，角色是很有必要的，例如：

![roleE-R](https://gitee.com/wangziming707/note-pic/raw/master/img/roleE-R.png)

表示课程间的 前置关系

## 非二元的联系集

