# 关系模型

在商用数据处理应用中，关系模型是主要的数据模型。它以其简易性简化了编程工作。

## 关系数据库的结构

关系数据库由表的集合构成，每个表有唯一的名字。一般来说，表中的一行代表了一组值之间的联系。一个表就是这种联系的集合，这也是关系数据模型名称的由来。

在关系模型中，**关系**(relation)用来代表表，**元组**(tuple)用来代指行，**属性**(attribute)代指表中的列。

**关系实例**(relation instance)这个术语来表示一个关系的特定实例，也就是所包含的一组特定的行。

关系是元组集合。所以元组在关系中出现的顺序是无关紧要的。即有相同元组的关系，即使元组的顺序不同，这样的关系也是相同的。为了便于说明，当我们在显示关系时，大多数情况下都按其第一个属性排序。

对于关系的每个属性，都存在一个允许取值的集合，称为该属性的**域**(domain)

如果域中的元素被看做是不可再分的单元，则域是**原子的**

我们要求对所有关系r而言，r的所有属性的域都是原子的,比如一张教师表的phone属性存储的是一组电话号码，它们phone的域就不是原子的。

空(null)值是一个特殊的值，表示值未知或者不存在。

## 数据库模式

数据库有数据库模式(database schema)和数据库实例(database instance)的概念，前者是数据库的设计逻辑，后者是给定时刻数据库中数据的一个快照。就像类和对象的概念关系。

对应的，**关系模式**(relatin schema)是对关系的设计定义。

一般来说，关系模式由属性序列以及个属性对应域组成。

关系实例的概念对应程序设计语言中变量的概念。当关系被更新时，关系实例的内容也随时间发生了变化。而关系模式是不常变化的。

尽管关系模式和关系实例之间的区分，但是常常使用一个名字代指它们。比如teacher，指代模式，也指代实例。

## 码

一个元组的属性值必须能够唯一区分元组。即一个关系中没有两个元组在所有属性上的取值都相同。

**超码**(superkey)时一个或者多个属性的集合，这些属性的组合可以使我们在一个关系中唯一地表示一个元组。例如：一个person关系中，id属性足以将不同的人元组区分开来，因此id使一个超码。但name属性不是一个超码，因为几个人可能同名。

用符号语言可以表示为:
$$
设R表示关系r模式中的属性集合。 \\
R的一个子集K是r的一个超码 \Leftrightarrow \vee 两个r中的元组 t_1、t_2,若t_1 \ne t_2,则t_1.K \ne t_2.K
$$
显然。如果K是一个超码，那么K的任意超集也是超码。

如果一个超码的任意真子集都不是超码，这样的超码称为**候选码**(candidate key)

一个关系模式中可以有多个候选码，在一个关系`instructor(id,name,dept_name)`中，如果name和dept_name的组合足以区分该关系中的各个成员，那么$\{id\}$和$\{name,dept\_name\}$都是候选码。同时要注意$\{id,name\}$只是超码不是候选码

我们用**主码**(primary key)这个术语来代码被数据库设计者选中的，主要用来在一个关系中区分不同元组的候选码

码(主码、候选码和超码)是整个关系的一种性质，而不是单个元组的性质。关系中的任意两个不同的元组都不允许同时在码属性上具有相同的值。码的指定代码了被建模的事物在现实世界中的约束。

主码应该选择那些值从不或者极少变化的属性。比如一个人的地址就不应该作为主码的一部分。但身份证号码可以保证从不变化，可以作为主码。

习惯上把一个关系模式的主码属性列在其他属性前面。

一个关系模式$r_1$可能在它的属性中包括另一个关系模式$r_2$的主码。这个属性在$r_1$上称作参照$r_2$的**外码**(foreign key).关系$r_1$也称为外码依赖的参照关系(referencing relation),$r_2$叫做外码的被参照关系(referenced relation)

例如关系`instructor(id,name,dept_id)` 和关系`department(dept_id,dept_name,)`那么instuctor的属性dept_id就称为参照department的外码。因为dept_id是department的主码。所以在任意的数据库实例中，从instructor关系中任取一个元组，该元组的dept_id属性上的取值在department关系中有对应的元组

这种在参照关系中任意元组在特定属性上的取值必然等于在被参照关系中某个元组的在特定属性上的取值的约束，被称为**参照完整性约束**（referential integrity constraint)

## 模式图

一个含有主码和外码依赖的数据库模式可以用模式图(schema diagram)来表示
